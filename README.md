# Booklight AI - 書籍ハイライト管理アプリ

Booklight AIは、Kindleなどの電子書籍からエクスポートしたハイライト情報を管理し、AIを活用して書籍ごとのサマリを生成するアプリケーションです。

## 主な機能

- Kindleハイライトのアップロードと管理
- 書籍ごとのAIによるサマリ生成
- 書籍一覧表示
- 書籍詳細表示（ハイライト一覧）
- ハイライト検索
- AIチャット（ハイライト情報を活用）

## 新機能: AIによる書籍サマリ生成

アップロードされた書籍のハイライト情報をもとに、AIが書籍ごとのサマリデータを生成し、参照先のサマリファイルとして保存します。

### 新しいサマリ生成アプローチ

最新バージョンでは、以下の革新的なアプローチでサマリを生成します：

1. **キーワード抽出**: 書籍の主要概念を特定
2. **クラスタリング**: 多様なトピックをカバーするハイライトを選択
3. **重要度ランキング**: 選択したハイライトを重要度順に並べ替え
4. **サマリ生成**: 上位のハイライトを連結して「サマリ」として使用

この方法により、書籍の多様なトピックをカバーしながら、最も重要な情報を優先した効果的なサマリが生成されます。

### 使い方

1. ハイライトアップロードページでKindleハイライトをアップロード
2. 「ハイライトを保存」ボタンをクリック
3. AIが自動的に書籍ごとのサマリを生成（プログレスバーで進捗状況を確認できます）
4. 生成されたサマリは書籍一覧ページと書籍詳細ページで閲覧可能

### 技術的な詳細

- OpenAI APIを使用してキーワード抽出（GPT-3.5-turboモデル）
- scikit-learnを使用したテキスト処理
  - TF-IDFベクトル化によるテキスト特徴抽出
  - K-meansクラスタリングによる多様なトピックの選択
  - コサイン類似度を用いたクラスター代表ハイライトの選択
- キーワード出現頻度に基づくハイライトの重要度ランキング
- 生成されたサマリはユーザーごとに`BookSummaries.csv`ファイルに保存
- 詳細な進捗表示機能
  - パーセンテージ表示のプログレスバー
  - 現在処理中の書籍タイトルをリアルタイム表示
  - 処理済み/全体の冊数を数値で表示

## 必要な環境変数

アプリケーションを実行するには、以下の環境変数が必要です：

```
OPENAI_API_KEY=your_openai_api_key
GOOGLE_CLIENT_ID=your_google_client_id
GOOGLE_CLIENT_SECRET=your_google_client_secret
REDIRECT_URI=http://localhost:8505/
```

## インストールと実行

1. リポジトリをクローン
2. 必要なパッケージをインストール: `pip install -r requirements.txt`
3. `.env`ファイルに必要な環境変数を設定
4. アプリケーションを実行: `streamlit run Home.py`

## ファイル構成

- `Home.py`: メインページ
- `auth.py`: 認証関連の処理
- `book_summary_generator.py`: AIによる書籍サマリ生成機能
- `pages/`: 各ページのスクリプト
  - `Upload.py`: ハイライトアップロードページ
  - `BookList.py`: 書籍一覧ページ
  - `BookDetail.py`: 書籍詳細ページ
  - `Search.py`: 検索ページ
  - `Chat.py`: チャットページ

## テスト・ユーティリティ

- `test_openai_api.py`: OpenAI APIの接続テスト
- `test_book_summary_generator.py`: 書籍サマリ生成機能のテスト
- `test_new_summary_approach.py`: 新しいサマリ生成アプローチのテスト
  - キーワード抽出
  - クラスタリング
  - 重要度ランキング
  - サマリ生成
- `manual_generate_summaries.py`: コマンドラインからサマリを手動生成するユーティリティ

### 手動サマリ生成

サマリが自動生成されない場合は、以下のコマンドで手動生成が可能です：

```
python manual_generate_summaries.py [ユーザーID]
```

ユーザーIDを省略した場合は、デフォルトユーザー（113701316513048922830）のサマリが生成されます。

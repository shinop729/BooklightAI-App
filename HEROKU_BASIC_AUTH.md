# Herokuアプリへのベーシック認証追加

このドキュメントでは、BooklightAIアプリにベーシック認証を追加して、機密ファイル（.envなど）への不正アクセスを防止する方法を説明します。

## 1. 実装内容

ベーシック認証は以下の2つのコンポーネントに追加されています：

1. **FastAPI（バックエンド）**: api/app/main.pyにミドルウェアとして実装
2. **Streamlit（フロントエンド）**: landing_page.pyに認証チェック関数として実装

## 2. 環境変数の設定

Herokuダッシュボードで以下の環境変数を設定する必要があります：

```
BASIC_AUTH_USERNAME=任意のユーザー名
BASIC_AUTH_PASSWORD=強力なパスワード
```

### Herokuダッシュボードから設定する場合

1. [Herokuダッシュボード](https://dashboard.heroku.com/)にログイン
2. BooklightAIアプリを選択
3. 「Settings」タブをクリック
4. 「Config Vars」セクションで「Reveal Config Vars」をクリック
5. 以下の変数を追加：
   - `BASIC_AUTH_USERNAME`: 任意のユーザー名（例: admin）
   - `BASIC_AUTH_PASSWORD`: 強力なパスワード（16文字以上、特殊文字を含む）

### Heroku CLIから設定する場合

```bash
heroku config:set BASIC_AUTH_USERNAME=任意のユーザー名 --app booklight-ai
heroku config:set BASIC_AUTH_PASSWORD=強力なパスワード --app booklight-ai
```

## 3. 保護されるパス

現在の実装では、以下のパスがベーシック認証で保護されます：

- `/.env`
- `/.env.local`
- `/.env.dev`
- `/api/.env`

追加の保護が必要なパスがある場合は、`api/app/main.py`の`protected_paths`リストに追加してください。

## 4. 開発環境での認証スキップ

開発環境では認証をスキップするオプションがあります。以下の環境変数を設定することで有効になります：

```
ENVIRONMENT=development
SKIP_BASIC_AUTH=true
```

## 5. セキュリティ上の注意点

1. **強力なパスワード**: 少なくとも16文字以上で、大文字、小文字、数字、特殊文字を含む強力なパスワードを使用してください。
2. **環境変数**: 認証情報は必ず環境変数として設定し、コードにハードコーディングしないでください。
3. **定期的な更新**: セキュリティを維持するために、定期的にパスワードを更新してください。
4. **アクセスログ**: 不審なアクセスがないか、定期的にHerokuのログを確認してください。

## 6. トラブルシューティング

### 認証が機能しない場合

1. 環境変数が正しく設定されているか確認
2. アプリが再起動されているか確認（`heroku restart --app booklight-ai`）
3. ログを確認（`heroku logs --tail --app booklight-ai`）

### 認証情報を忘れた場合

1. Herokuダッシュボードで環境変数を確認
2. 必要に応じて新しい認証情報を設定

## 7. 追加のセキュリティ対策

ベーシック認証に加えて、以下の対策も検討してください：

1. **IP制限**: 特定のIPアドレスからのみアクセスを許可
2. **セッションタイムアウト**: 一定時間後に自動的にログアウト
3. **アクセスログ監視**: 不審なアクセスパターンを検出
4. **定期的なセキュリティ監査**: 脆弱性がないか定期的に確認

---

この実装により、.envファイルなどの機密ファイルへの不正アクセスを防止し、アプリケーションのセキュリティを向上させることができます。
